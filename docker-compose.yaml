version: "3.9"

services:
  jupyter:
    build:
      context: .
      dockerfile: Dockerfile.jupyter
    container_name: beat-gamma-jupyter
    command: >
      sh -c "uv run jupyter lab
        --ip=0.0.0.0 --port=8888 --allow-root
        --ServerApp.token=''
        --ServerApp.password=''
        --ServerApp.disable_check_xsrf=True
        --ServerApp.allow_remote_access=True"
    ports:
      - "8888:8888"

  mcp:
    build:
      context: .
      dockerfile: Dockerfile.jupyter
    container_name: beat-gamma-mcp
    depends_on:
      - jupyter
    command: >
      sh -c "uv run jupyter-mcp-server start
        --transport streamable-http
        --jupyter-url http://jupyter:8888
        --port 4040"
    ports:
      - "4040:4040"

  worker:
    build:
      context: .
      dockerfile: Dockerfile.worker
    container_name: beat-gamma-worker
    depends_on:
      - mcp
    environment:
      MCP_JUPYTER_URL: "http://mcp:4040/mcp"
      GOOGLE_API_KEY: "${GOOGLE_API_KEY}"
      TAVILY_API_KEY: "${TAVILY_API_KEY}"
      LANGSMITH_TRACING: "${LANGSMITH_TRACING}"
      LANGSMITH_ENDPOINT: "${LANGSMITH_ENDPOINT}"
      LANGSMITH_API_KEY: "${LANGSMITH_API_KEY}"
      LANGSMITH_PROJECT: "${LANGSMITH_PROJECT}"
      QDRANT_URL: "${QDRANT_URL}"
      QDRANT_API_KEY: "${QDRANT_API_KEY}"
      AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_ID}"
      AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_ACCESS_KEY}"
      AWS_BUCKET_NAME: "${AWS_BUCKET_NAME}"
      AWS_REGION: "${AWS_REGION}"
      SQS_QUEUE_URL: "${SQS_QUEUE_URL}"
      SUPABASE_KEY: "${SUPABASE_KEY}"
      SUPABASE_URL: "${SUPABASE_URL}"

